aliases:
  - &android
    components:
      - tools
      - platform-tools
      - android-26
      - extra-google-m2repository
      - extra-google-google_play_services

  - &android-cache
    directories:
      - ~/.cache/yarn
      - ~/.gradle/caches/modules-2
      - ~/.gradle/wrapper

  - &ios-cache
    directories:
      - ~/.rncache
      - ~/Library/Caches/Yarn
      - ~/Library/Caches/CocoaPods

jobs:
  include:
    - stage: ios-beta
      # if: branch = develop AND type = push
      os: osx
      osx_image: xcode11.3
      language: node_js
      cache: *ios-cache
      node_js:
        - lts/*
      before_install:
        - sudo gem install fastlane
        - npm install -g yarn
      install:
        - "./write-keys.sh"
        - "./install-deps.sh pods"
      script:
        - "./deploy-ios-beta.sh"
    - stage: android-beta
      # if: branch = develop AND type = push
      language: android
      jdk: oraclejdk8
      android: *android
      cache: *android-cache
      before_script:
        - ./internals/scripts/travis/gitconfig.sh
      install:
        - "./install-deps.sh"
        - bundle install
      script:
        - "./deploy-android-beta.sh"
env:
  global:
    - APP_NAME="Memex Mobile"
    - 'DEVELOPER_NAME="iPhone Distribution: WorldBrain UG (haftungsbeschr√§nkt)"'
    - PROFILE_NAME="travis"
